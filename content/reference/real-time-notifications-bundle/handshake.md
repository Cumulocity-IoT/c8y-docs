---
weight: 20
title: Handshake
layout: redirect
---

A real-time notifications client initiates connection negotiation by sending a message to the "/meta/handshake" channel. In response, the client receives a *clientId* which identifies a conversation and must be passed in every non-handshake request.

When using websockets, a property 'ext' containing an authentication object must also be sent. In case of basic authentication the "token" is used with base64 encoded credentials.  In case of OAuth authentication the request must have the cookie with the authorization name, holding the access token. Further more the XSRF token must be forwarded as part of the handshake message.

    {
      "ext": {
        "com.cumulocity.authn": {
          "token": "<base64 encoded credentials>",
          "tfa": "<tfa token>",
          "xsrfToken": "<xsrf token>",
        },
        "systemOfUnits": "<system of units>"
      }
    }

|Property|Value|
|:-------|:----|
|token|Base 64 encoded credentials.|
|tfa|Optional two factor authentication token.|
|xsrfToken|Required for OAuth authentication.|
|systemOfUnits|Optional system of units. Possible values are "imperial" or "metric".|

### Request

|Name|Type|Occurs|Description|
|:---|:---|:-----|:----------|
|id|string|1|ID of message, required to match response message.|
|channel|string|1|The channel name as a URI, required value: "/meta/handshake".|
|ext|Object|1|Authentication object passed to handshake (only over websockets).|
|version|string|1|Bayeux protocol version used by client.|
|minimumVersion|string|0..1|Minimum server-side Bayeux protocol version required by client.|
|supportedConnectionTypes|array|1|List of connection types supported by client.|

Example request:

    POST /notification/realtime
    Host: ...
    Authorization: Basic ...
    Content-Length: ...
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "ext": {
          "com.cumulocity.authn": {
            "token": "<base64 encoded credentials>"
          }
        }
        "version": "1.0",
        "mininumVersion": "1.0beta",
        "supportedConnectionTypes": ["websocket","long-polling"]
      }
    ]

### Response

<table>
<colgroup>
<col style="width: 25%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Occurs</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">id</td>
<td align="left">string</td>
<td align="left">1</td>
<td align="left">ID of message passed in request message.</td>
</tr>
<tr>
<td align="left">channel</td>
<td align="left">string</td>
<td align="left">1</td>
<td align="left">The channel name as a URI, required value: “/meta/handshake”.</td>
</tr>
<tr>
<td align="left">version</td>
<td align="left">string</td>
<td align="left">0..1</td>
<td align="left">Bayeux protocol version used by server.</td>
</tr>
<tr>
<td align="left">minimumVersion</td>
<td align="left">string</td>
<td align="left">0..1</td>
<td align="left">Minimum client-side Bayeux protocol version required by server.</td>
</tr>
<tr>
<td align="left">supportedConnectionTypes</td>
<td align="left">array</td>
<td align="left">0..1</td>
<td align="left">Connection types supported by both client and server (i.e., intersection between client and server options).</td>
</tr>
<tr>
<td align="left">clientId</td>
<td align="left">string</td>
<td align="left">0..1</td>
<td align="left">Unique client ID generated by server.</td>
</tr>
<tr>
<td align="left">successful</td>
<td align="left">boolean</td>
<td align="left">1</td>
<td align="left">Result of handshake.</td>
</tr>
<tr>
<td align="left">error</td>
<td align="left">string</td>
<td align="left">0..1</td>
<td align="left">Handshake failure reason.</td>
</tr>
</tbody>
</table>

Example of successful response:

    HTTP/1.1 200 OK
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "version": "1.0",
        "minimumVersion": "1.0",
        "supportedConnectionTypes": ["websocket"],
        "clientId": "Un1q31d3nt1f13r",
        "successful": true
      }
    ]

Example of failed response:

    HTTP/1.1 200 OK
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "successful": false,
        "error":"403::Handshake denied"
      }
    ]
