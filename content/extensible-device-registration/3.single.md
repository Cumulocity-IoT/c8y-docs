---
weight: 30
title: Single Device Registration 
layout: bundle
---

After enabling `extensibleDeviceRegistration` extension type, Device management > Devices > `Register Device` menu is being extended with entry named after extension `name` property:
![Select guide](/images/extensible-device-registration/menu.png)

From now on everything will be rendered based in data provided via custom microservice. Added menu entry will open modal which is going to fetch the form definition using following endpoint:
![Select guide](/images/extensible-device-registration/api-metadata.png) <-- fix lang param!

> **Note** the context of the microservice, which is taken from application definition:
>```
>{
>  "contextPath": "<relative path>",
>  "availability": "MARKET",
>  "type": "MICROSERVICE",
>  "name": "<agent name>",
>  ...
>}```

> **IDEA!** Add GitHub link with reference implementation

Example definition:
```json
{
  "title": "Device registration",
  "description": "",
  "pages": [
    {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "type": "object",
      "title": "Mandatory settings",
      "required": [
        "endpointId",
        "security"
      ],
      "properties": {
        "endpointId": {
          "examples": [
            "urn:imei:012345678901234"
          ],
          "type": "string",
          "title": "Endpoint client ID"
        }
      }
    },
    {...},
    {...}
  ]
  ...
}
```
The important part is `pages` array which contains steps of the wizard that the modal si going to render accordingly to Json Schema definition: [https://json-schema.org/](https://json-schema.org/)
JSON Schema is a generic-purpose language to specify data, along with constraints and data types and simple validations.

As a result of following stepper will be displayed:
![Select guide](/images/extensible-device-registration/lwm2m.png)

In the final step all data collected vie the wizard will be sent back to the microservice using following rest endpoint:
![Single diagram](/images/extensible-device-registration/api-register.png)
The form is able to send anything defined via JSON Schema standard and the microservis which provides the form definition is responsible to properly handle submitted data.

> **--==IDEA==--**  Maybe we should provide some examples like conditionals, files or simple radio buttons?
  

### API Specification (swagger or inline?) 
![Single diagram](/images/extensible-device-registration/api.png)

### API Specification

The device integration microservices have to implement following REST endpoints:

1. `GET /service/<contextPath>/deviceRegistration/metadata`
Returns the metadata in the JSON dialect
2. `POST /service/<contextPath>/deviceRegistration`
Creates a single device based on collected information. Accepts a list of key value pairs

### Single Device Registration flow diagram
![Single diagram](/images/extensible-device-registration/single-diagram.png)


