---
order: 20
title: Handshake
layout: redirect
---

A real-time notifications client initiates connection negotiation by sending a message to the "/meta/handshake" channel. In response, the client receives a *clientId* which identifies a conversation and must be passed in every non-handshake request.
When using websockets, a property 'ext' containing an authentication object must also be sent.

    {
      "ext": {
        "com.cumulocity.authn": {
          "token": "<base64 encoded credentials>",
          "tfa": "<tfa token>",
        },
        "systemOfUnits": "<system of units>"
      }
    }

|Property|Value|
|:-------|:----|
|token|Base 64 encoded credentials|
|tfa|Optional two factor authentication token|
|systemOfUnits|Optional system of units. Possible values are "imperial" or "metric"|

### Request

|Name|Type|Occurs|Description|
|:---|:---|:-----|:----------|
|id|Integer|1|Id of message, required to match response messageï¿½|
|channel|URI|1|Name of channel, required value "/meta/handshake".|
|ext|Object|1|Authentication object passed to handshake. (only over websockets)|
|version|String|1|Bayeux protocol version used by client.|
|minimumVersion|String|0..1|Minimum server-side Bayeux protocol version required by client.|
|supportedConnectionTypes|Array|1|List of connection types supported by client.|
|advice|Object|0..1|Session configuration parameters.|

### Advice

|Name|Type|Occurs|Description|
|:---|:---|:-----|:----------|
|timeout|Integer|0..1|Max. time in milliseconds between sending of a connect message and response from server. Overrides server default settings for session. Default value : 5400000, maximum value 7200000|
|interval|Integer|0..1|The time, in milliseconds, that the client must wait between the end of one long poll request and the start of the next. Overrides server default settings for session. When not set server allows for max 10 sec delay between next connect request. Default value : 0|

Example request:

    POST /cep/realtime
    Host: ...
    Authorization: Basic ...
    Content-Length: ...
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "ext": {
          "com.cumulocity.authn": {
            "token": "<base64 encoded credentials>"
          }
        }
        "version": "1.0",
        "mininumVersion": "1.0beta",
        "supportedConnectionTypes": ["websocket","long-polling"],
        "advice":{"timeout":120000,"interval":30000}
      }
    ]

### Response

|Name|Type|Occurs|Description|
|:---|:---|:-----|:----------|
|id|Integer|1|Id of message passed in request message|
|channel|URI|1|Name of channel, required value "/meta/handshake".|
|version|String|0..1|Bayeux protocol version used by server.|
|minimumVersion|String|0..1|Minimum client-side Bayeux protocol version required by server.|
|supportedConnectionTypes|Array|0..1|Connection types supported by both client and server (i.e., intersection between client and server options).|
|clientId|String|0..1|Unique client ID generated by server.|
|successful|Boolean|1|Result of handshake.|
|error|String|0..1|Handshake failure reason.|

Example of successful response:

    HTTP/1.1 200 OK
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "version": "1.0",
        "minimumVersion": "1.0",
        "supportedConnectionTypes": ["websocket"],
        "clientId": "Un1q31d3nt1f13r",
        "successful": true
      }
    ]

Example of failed response:

    HTTP/1.1 200 OK
    Content-Type: application/json
    [
      {
        "channel": "/meta/handshake",
        "successful": false,
        "error":"403::Handshake denied"
      }
    ]

