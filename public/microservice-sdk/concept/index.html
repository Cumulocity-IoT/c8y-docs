<!DOCTYPE html>
<html>
<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <base href="" />
    <meta name="generator" content="Hugo 0.54.0 with theme C8yDocs">
    <title>General aspects - Cumulocity IoT Guides</title>
    <meta name="author" content="Carlos Ceia @ Cumulocity">
    <meta name="keywords" content=", Software AG Cloud, Cumulocity IoT, Internet of things, analytics, devices, connect">


    <link rel="icon" href="/favicon.ico">

    

    

    
    
    
    <link rel="stylesheet" href="https://cumulocity.com/guides/style.css">
    

      
      <script> window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(c){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var o=this.createElement("script");n&&(this.domain=n),o.id="js-iframe-async",o.src=e,this.t=+new Date,this.zendeskHost=t,this.zEQueue=a,this.body.appendChild(o)},o.write('<body onload="document._l();">'),o.close()}("https://assets.zendesk.com/embeddable_framework/main.js","cumulocity.zendesk.com"); </script>
        <script type="text/JavaScript">
          window.zESettings = {
            webWidget: {
              color: {
                theme: '#1776bf'    
              },
              position: {
                horizontal: 'right',
                vertical: 'top'     
              }
            }
          };
          </script>
        
        
   
  </head><body data-spy="scroll" data-target="#main-nav" ><button type="button" class="sidebar-toggle">
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span>MENU</span>
</button>
<nav class="main-top-bar" >
  <div class="d-flex container">
    <ul class="nav d-flex flex-start hidden-xs nav-left">
      <li><a href="https://www.softwareag.cloud/site/product/cumulocity-iot.html">Cumulocity IoT</a></li>
      <li><a href="http://resources.cumulocity.com/documentation/jssdk/latest/#/api">Cumulocity Angular API</a></li>
    </ul>
    <ul class="nav flex-end nav-right">
      <li>   <script>
              (function() {
                var cx = '008969372384807682938:yeh7xt785g4';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
        <div id="___gcse_0" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><div class="table-responsive"><table cellspacing="0" cellpadding="0" class="gsc-search-box"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table cellspacing="0" cellpadding="0" id="gs_id50" class="gstl_50 gsc-input" style="width: 100%; padding: 0px;"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" id="gsc-i-id1" placeholder="Custom Search" dir="ltr" spellcheck="false" x-webkit-grammar="builtin:search" lang="en" style="width: 100%; padding: 0px; border: none; margin: -0.0625em 0px 0px; height: 1.25em; background: url(&quot;https://www.google.com/cse/static/images/1x/googlelogo_lightgrey_46x16dp.png&quot;) left center no-repeat rgb(255, 255, 255); text-indent: 48px; outline: none;"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" style="display: none;" title="Clear search box" role="button"><span class="gscb_a" id="gs_cb50" aria-hidden="true">×</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><button class="gsc-search-button gsc-search-button-v2"><svg width="13" height="13" viewBox="0 0 13 13"><title>search</title><path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path></svg></button></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table></div></form></div>
      </li>
    </ul>
  </div>
</nav><button type="button" class="to-the-top">
  <span class="sr-only">Top</span>
  <span class="fa fa-chevron-up"></span>
</button><nav class="main-nav navbar">
  <header class="nav-header">
    <a href="https://www.softwareag.cloud/site/dev-center/cumulocity-iot.html">
      <img src="https://cumulocity.com/guides/images/cumulocity-iot.svg"
        class="img-responsive no-zoom"
        alt="Cumulocity IoT">
    </a>

    <div class="dropdown">
      <button class="dropdown-toggle"
        type="button"
        id="dropdownMenuButton"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false">
        <span id="current-dropdown-toggle" class="text-truncate"></span> <span class="caret"></span>
      </button>
      <div class="dropdown-menu"
        aria-labelledby="dropdownMenuButton">
        
        
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/release-notes/overview/'><i class="c8y-icon c8y-icon-notification"></i> Release notes</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/concepts/introduction/'><i class="c8y-icon c8y-icon-c8y-data"></i> Concepts guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/users-guide/getting-started/'><i class="c8y-icon c8y-icon-user"></i> User guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/benutzerhandbuch/overview/'><i class="c8y-icon c8y-icon-user"></i> Handbuch</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/devices/overview/'><i class="c8y-icon c8y-icon-device-management"></i> Device guides</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/edge/overview/'><i class="fa fa-book"></i> Cumulocity IoT Edge</a>
        
        
        
        
        
        
        
        

        
        
        
        
        <span class="current-app">Microservice SDK guide</span>
        
        

        <a class='dropdown-menu-item active'
          href='https://cumulocity.com/guides/microservice-sdk/introduction/'><i class="c8y-icon c8y-icon-tools"></i> Microservice SDK guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/device-sdk/introduction/'><i class="c8y-icon c8y-icon-tools"></i> Device SDK guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/web/introduction/'><i class="c8y-icon c8y-icon-smart-rest"></i> Web SDK guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/apama/overview-analytics/'><i class="c8y-icon c8y-icon-data-explorer"></i> Analytics guide</a>
        
        
        
        
        
        
        
        

        
        
        

        <a class='dropdown-menu-item '
          href='https://cumulocity.com/guides/reference/rest-implementation/'><i class="fa fa-book"></i> Reference guide</a>
        
      </div>
    </div>
  </header>

  

  <nav id="main-nav"
    class="nav-sections">
    
    
    <div class="">
        
        
        
        
      <a class=""
        href="https://cumulocity.com/guides/microservice-sdk/introduction/">Microservices SDK</a>
     
      
    </div>
    
    
    
    <div class=" slot-active ">
        
        
        
        
      <a href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#page-nav1"
        class="collapse-btn ">
        <i class="fa fa-chevron-right "></i>
      </a>
      
      <a class=" active "
        href="https://cumulocity.com/guides/microservice-sdk/concept/">General aspects</a>
     
      
      
      <div id="page-nav1"
        class="collapse   show  ">
        <nav class="list-group nav">
          
          
          <a class="list-group-item"
            href="#overview">Overview</a>
          
            
          
          <a class="list-group-item"
            href="#docker">Docker image and container</a>
          
            
          
          <a class="list-group-item"
            href="#manifest">Microservice manifest</a>
          
            
          
          <a class="list-group-item"
            href="#isolation-levels">Microservice isolation levels</a>
          
            
          
          <a class="list-group-item"
            href="#scaling">Scaling</a>
          
            
          
          <a class="list-group-item"
            href="#security">Security</a>
          
            
          
          <a class="list-group-item"
            href="#environment-variables">Environment variables</a>
          
            
          
          <a class="list-group-item"
            href="#packaging">Packaging</a>
          
            
          
          <a class="list-group-item"
            href="#request-routing">Request routing</a>
          
            
          
          <a class="list-group-item"
            href="#requirements">Microservice requirements</a>
          
            
          
          <a class="list-group-item"
            href="#operation">Operating microservices</a>
          
            
          
          <a class="list-group-item"
            href="#deployment">Deploying microservices</a>
          
            
        </nav>
      </div>
      
    </div>
    
    
    
    <div class="">
        
        
        
        
      <a href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#page-nav2"
        class="collapse-btn  collapsed ">
        <i class="fa fa-chevron-right "></i>
      </a>
      
      <a class=""
        href="https://cumulocity.com/guides/microservice-sdk/java/">Microservice SDK for Java</a>
     
      
      
      <div id="page-nav2"
        class="collapse   ">
        <nav class="list-group nav">
          
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/java/#introduction">Overview</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/java/#java-microservice">Hello microservice!</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/java/#developing-microservice">Developing Microservices</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/java/#developing-services-client">Developing Java clients for services</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/java/#troubleshooting">Troubleshooting</a>
            
            
        </nav>
      </div>
      
    </div>
    
    
    
    <div class="">
        
        
        
        
      <a href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#page-nav3"
        class="collapse-btn  collapsed ">
        <i class="fa fa-chevron-right "></i>
      </a>
      
      <a class=""
        href="https://cumulocity.com/guides/microservice-sdk/cs/">Microservice SDK for C#</a>
     
      
      
      <div id="page-nav3"
        class="collapse   ">
        <nav class="list-group nav">
          
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/cs/#introduction">Overview</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/cs/#hello-world-basic">Hello, world!</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/cs/#developing-microservice">Developing Microservices</a>
            
            
        </nav>
      </div>
      
    </div>
    
    
    
    <div class="">
        
        
        
        
      <a href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#page-nav4"
        class="collapse-btn  collapsed ">
        <i class="fa fa-chevron-right "></i>
      </a>
      
      <a class=""
        href="https://cumulocity.com/guides/microservice-sdk/rest/">Using the REST interface</a>
     
      
      
      <div id="page-nav4"
        class="collapse   ">
        <nav class="list-group nav">
          
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/rest/#overview">Overview</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/rest/#microservice-development">Microservice development</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/rest/#application-development">Application development</a>
            
            
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/rest/#smartrest">Using SmartREST</a>
            
            
        </nav>
      </div>
      
    </div>
    
    
    
    <div class="">
        
        
        
        
      <a href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#page-nav5"
        class="collapse-btn  collapsed ">
        <i class="fa fa-chevron-right "></i>
      </a>
      
      <a class=""
        href="https://cumulocity.com/guides/microservice-sdk/http/">Python example</a>
     
      
      
      <div id="page-nav5"
        class="collapse   ">
        <nav class="list-group nav">
          
          
            <a class="list-group-item"
              href="https://cumulocity.com/guides/microservice-sdk/http/#hello-microservice-python">Hello Microservice Python</a>
            
            
        </nav>
      </div>
      
    </div>
    
    
    
    
  </nav>
</nav>
<div class="cover"></div>

<div class="main-content">
  <article class="page-section">
    <header class="section-header">
      <h1 class="text-light">General aspects</h1>
    </header>
    
      <div class="lead">
        
      </div>
      
  </article>

  
  
  
  <article id="overview" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#overview">
        <span class="fa fa-link"></span>
      </button>
      Overview</h2>
    <p>With microservices, you can extend the Cumulocity IoT platform with customer-specific functionality. For example, you can develop integrations to 3rd-party software or provide server-side business logic.</p>

<p>Technically, microservices are docker containers, hosted by Cumulocity, which
follow specific conventions. They typically access Cumulocity using a REST API available under /service/&lt;microservice-name&gt;.</p>

<p>When developing a Cumulocity microservice, a developer is not restricted to any programming language. However, a microservice must serve as a HTTP server working on port 80 and must be encapsulated in a docker image. Refer to the relevant chapters in this guide for further information on using specific programming languages for the development of microservices.</p>

  </article>
  
  <article id="docker" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#docker">
        <span class="fa fa-link"></span>
      </button>
      Docker image and container</h2>
    <p>The Cumulocity microservice is based on docker. This requires that a microservice is packaged as docker image in order to run on the Cumulocity platform. The docker image is an executable package that includes everything needed to run an application. For more information on docker refer to the <a href="https://docs.docker.com/get-started/">Docker documentation</a>).</p>

<p>During run-time, the microservice is executed in a docker container. A docker container ensures that the microservices cannot harm other microservices running in Cumulocity. To execute docker containers, Cumulocity uses kubernetes. Kubernetes provides many enterprise-grade features for hosting docker containers, including auto-scaling, high availability, load balancing, rolling upgrades to limit downtime, resource quota and more.</p>

<blockquote>
<p><strong>Info:</strong> Currently kubernetes is not exposed to developers or users. This allows changing of the underlying infrastructure in the future.</p>
</blockquote>

  </article>
  
  <article id="manifest" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#manifest">
        <span class="fa fa-link"></span>
      </button>
      Microservice manifest</h2>
    <p>The microservice manifest provides the required settings to manage microservice instances and the Cumulocity application.
Refer to the <a href="/guides/reference/microservice-manifest">Microservice manifest reference</a> in the Reference guide to see the full list of options.</p>

  </article>
  
  <article id="isolation-levels" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#isolation-levels">
        <span class="fa fa-link"></span>
      </button>
      Microservice isolation levels</h2>
    <p>The following isolation levels are available for microservices:</p>

<ul>
<li><strong>Multi-tenant</strong>: Single microservice docker container instantiated for all subscribed tenants unless microservice is scaled.</li>
<li><strong>Single tenant</strong>: Dedicated microservice docker container instantiated for each subscribed tenant.</li>
</ul>

<p>The isolation level is set using the microservice manifest.</p>

  </article>
  
  <article id="scaling" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#scaling">
        <span class="fa fa-link"></span>
      </button>
      Scaling</h2>
    <p>If scaling is enabled, the microservice is horizontally auto-scaled in case of high CPU usage.</p>

<p>The scale option is set using the microservice manifest.</p>

  </article>
  
  <article id="security" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#security">
        <span class="fa fa-link"></span>
      </button>
      Security</h2>
    <p>Microservices typically provide a REST API. For inbound REST requests, Cumulocity provides a light API gateway (“Proxy”) and inbound websocket requests are not supported. This API gateway is located between the client and the microservice container. The API gateway provides:</p>

<ul>
<li>Authorization: All calls are authenticated using Cumulocity users basic or OAuth authorization.</li>
<li>TLS Termination: TLS inbound calls are terminated and only HTTP is used inside the cluster.</li>
<li>Metering: The API calls are metered in the “API calls” tenant statistics.</li>

<li><p>Routing: The API gateway routes requests for “/service/&lt;name&gt;” to the microservice “&lt;name&gt;”. The request routed to the microservice container and tenant options are added to the request headers.</p></li>

<li><p>Tenant platform user: The user that logs into the application. Created using the Cumulocity Administration application.</p></li>

<li><p>Microservice Bootstrap user: The user being created for microservice bootstrap operations, it is connected to application itself. This user is authorized to get the microservice subscriptions and do requests for its application. Refer to <a href="/guides/microservice-sdk/rest#microservice-development">Microservice development</a> for more details.</p></li>

<li><p>Service user: Reflects tenant subscription to a microservice.</p></li>
</ul>

<p>A request to a microservice can be authorized using basic or OAuth. In case of basic authentication the flow is fairly simple, as credentials can be read and utilized for further authentication to the platform. Authentication with OAuth is based on cookies technology, so the access token has to be read from the request Cookie header. There are two important parts of OAuth authorization, an access token stored in the &lsquo;authorization&rsquo; cookie and an X-XSRF-TOKEN header for XSRF attack prevention. Both must be forwarded with the request to the platform. Additionally, it is important to understand that the access token has a limited lifetime. Currently support for OAuth is provided only for Microservice SDK for Java since 9.12.6, however we recommend to use the newest version.</p>

<p>Any request to the platform must be done with the platform user. For microservices, it is best practice to switch context to the subscribed tenant&rsquo;s service user instead of using the tenant&rsquo;s platform user when doing a request from microservice to the Cumulocity platform. The reason is that a service user always has roles defined in requiredRoles parameter, thus always has the same permissions. On the other hand it is common for tenant platform users to have different permissions, thus a microservice can misbehave.</p>

<p>A microservice runtime provides bootstrap user and service user credentials in form of environment variables. These can be also acquired via platform API. Note that depending on the isolation level the environment variables differ.</p>

<p>Per tenant scope:<br />
C8Y_BOOTSTRAP_TENANT - application owner tenant id<br />
C8Y_BOOTSTRAP_USER - username of bootstrap user<br />
C8Y_BOOTSTRAP_PASSWORD - password of bootstrap user<br />
C8Y_TENANT - subscribed tenant id<br />
C8Y_USER - username of service user of a subscribed tenant<br />
C8Y_PASSWORD - password of service user of a subscribed tenant</p>

<p>Multi tenant scope:<br />
C8Y_BOOTSTRAP_TENANT - application owner tenant id<br />
C8Y_BOOTSTRAP_USER - username of bootstrap user<br />
C8Y_BOOTSTRAP_PASSWORD - password of bootstrap user</p>

<p>In multi tenant scope there is a single microservice deployment reused by multiple tenants. This is why service user credentials are not provided as hardcoded environment properties. However a microservice running in multi tenant isolation can retrieve all subscriptions via</p>

<pre><code>GET /application/currentApplication/subscriptions 
Host: ...
Authorization: Basic ...
</code></pre>

<p>using bootstrap credentials.</p>

<p>Bootstrap user credentials can be also retrieved using</p>

<pre><code>GET /application/applications/{APPLICATION_ID}/bootstrapUser
Host: ...
Authorization: Basic ...
</code></pre>

<p>authorized with an application owner credentials.</p>

<p>Example of a typical user switching in multi tenant isolation is presented below, where in a hypothetical scenario there is a need to send an alarm to each tenant subscribed to a microservice.</p>

<p><img src="/guides/images/concepts-guide/microserviceusersexample.png" alt="microservice_user_switch_example" /></p>

<p>Steps:
1. User wants to use microservice capabilities to raise alarms to all subscribed tenants calls and calls platform /service/{microservice}/createAlarms.
2. Platform verifies user credentials and redirects request to a microservice.
3. Microservice reads bootstrap credentials (from environment variables) and uses them to retrieve service user credentials for all subscribed tenants.
4. Microservice iterates over service user credentials and uses them to create alarms to each tenant.
5. Microservice returns result to platform, and platform to invoking user.</p>

<p>The following role types are defined for users:</p>

<ul>
<li>Required roles: The roles that are predefined to allow access to Cumulocity Rest APIs.
As an example, if a microservice creates measurements using the service user, measurement admin role must be added as a required role of the application.
Required roles are added to the service users.</li>
<li>Roles: The custom roles provided to tenant platform users by the microservice developer.
These roles can be assigned or revoked to the tenant platform users or groups using the Administration application.</li>
</ul>

<p>The roles are provided in the microservice manifest.</p>

  </article>
  
  <article id="environment-variables" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#environment-variables">
        <span class="fa fa-link"></span>
      </button>
      Environment variables</h2>
    <p>Microservices need to understand certain details about the specific Cumulocity cluster they are running in. For example, a microservice needs to know the endpoint address of the Cumulocity REST APIs. This information is provided in environment variables. The environment variables are injected by Cumulocity when the container is started.</p>

<p>Refer to <a href="/guides/reference/microservice-runtime">Microservice container runtime reference</a> in the Reference guide for a list of provided environment variables.</p>

  </article>
  
  <article id="packaging" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#packaging">
        <span class="fa fa-link"></span>
      </button>
      Packaging</h2>
    <p>To deploy a microservice, it needs to be packaged as docker image. It requires a docker image.tar and cumulocity.json files packed into a zip file. For your convenience, Cumulocity provides a script.</p>

<p>Refer to <a href="/guides/reference/microservice-package">Microservice package reference</a> in the Reference guide in order to prepare and deploy the microservice package.</p>

  </article>
  
  <article id="request-routing" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#request-routing">
        <span class="fa fa-link"></span>
      </button>
      Request routing</h2>
    <p>The request is redirected to a microservice depending on isolation level (auto-scaling is ignored at this moment for clarity), subscription and authorization. A typical request to the platform looks like</p>

<pre><code>{METHOD} /service/{MICROSERVICE}/{MICROSERVICE_ENDPOINT} 
Host: ...
Authorization: Basic ...
</code></pre>

<p>First, credentials are used to verify if a requesting user is authorized to access the microservice. Secondly, tenant subscription is verified. If both checks pass, the request is routed to a dedicated microservice deployment in case of PER_TENANT isolation, or to a shared deployment in case of MULTI_TENANT isolation.</p>

<p>The routed request is stripped of /service/{MICROSERVICE} part, however the Authorization header is not modified, thus a request is still executed as a tenant platform user.</p>

<pre><code>{METHOD} /{MICROSERVICE_ENDPOINT} 
Host: ...
Authorization: Basic ...
</code></pre>

  </article>
  
  <article id="requirements" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#requirements">
        <span class="fa fa-link"></span>
      </button>
      Microservice requirements</h2>
    <p>The following requirements towards Cumulocity microservices must be met:</p>

<ul>
<li>A microservice MUST be a (linux/amd64) docker image run.</li>
<li>The docker image MUST be packaged as “image.tar” and MUST include a manifest file (cumulocity.json).</li>
<li>A microservice MUST be stateless, i.e. it must contain only ephemeral state. Reason is that the microservice must be able to survive (random) restarts because of hardware (server failure) and operations reasons (upgrade, migration).</li>
<li>All persistent state MUST be stored at the Cumulocity platform via inventory, binary, tenant options and other APIs. Persistent volumes are not supported.</li>
<li>A microservice cannot access the database directly and must use Cumulocity API.</li>
<li>A microservice must provide one inbound REST API. Additional inbound ports are not supported.</li>
<li>A microservice can use multiple outbound ports.</li>
<li>The request lifetime MUST have the maximum. The infrastructure might terminate too long running requests.</li>
<li>Log informations needs to be send to standard output to be captured and persisted by infrastructure.</li>
</ul>

  </article>
  
  <article id="operation" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#operation">
        <span class="fa fa-link"></span>
      </button>
      Operating microservices</h2>
    <p>Cumulocity manages microservices by monitoring the microservice instance and storing the metrics. In case a microservice exceeds the memory limit, it is restarted automatically. Microservices can be scaled in case of high CPU usage.</p>

  </article>
  
  <article id="deployment" class="page-section">
    <h2>
      <button class="btn-link bookmark" data-clipboard-text="#deployment">
        <span class="fa fa-link"></span>
      </button>
      Deploying microservices</h2>
    <p>For a microservice to be available it has to be deployed at the Cumulocity platform. This is done by uploading a zip file with the microservice package. A user cannot directly push to the docker registry.</p>

<p>For further information on deploying microservices to Cumulocity, refer to <a href="/guides/users-guide/administration#managing-applications">Administration &gt; Managing applications</a> in the User guide.</p>

<p>The microservice package must contain the manifest file and docker image of the microservice.</p>

<p>Refer to <a href="/guides/reference/microservice-manifest">Microservice manifest reference</a> in the Reference guide for details on how to create a manifest file with applicable settings.</p>

<p>Refer to <a href="/guides/microservice-sdk/concept#packaging">Packaging</a> for details on how to prepare and deploy the microservice package.</p>

<blockquote>
<p><strong>Info:</strong> In case of microservices, you need to subscribe to the application to use it.</p>
</blockquote>

  </article>
  
  
</div>
<footer class="main-footer">
  <div class="copyright">
    <div class="container text-center">
      <p class="small ">&copy; 2019 Cumulocity GmbH | All rights reserved.</p>
    </div>
  </div>  
</footer>

<!-- Essential Scripts -->

<!-- jQuery -->
<script src="https://cumulocity.com/guides/js/vendor/jquery.min.js"></script>
<script src="https://cumulocity.com/guides/js/vendor/bootstrap.bundle.min.js"></script>
<script src="https://cumulocity.com/guides/js/vendor/clipboard.js"></script>
<script src="https://cumulocity.com/guides/js/vendor/zoom.js"></script>
<script src="https://cumulocity.com/guides/js/vendor/highlight.min.js"></script>
<script src="https://cumulocity.com/guides/js/main.js"></script>





    
   
  </body>
</html>
